#include <Wire.h>
#include <LiquidCrystal_I2C.h>
#include "LedControl.h"
#include "AppController.h"


LiquidCrystal_I2C lcd(0x27, 16, 2);
LedControl lc = LedControl(12, 11, 10, 1); // DIN, CLK, CS

Timer miTimer;
LedAnimator miAnimador(lc, 1000UL);


const int PIN_VERDE = 7;
const int PIN_ROJO  = 6;
const int PIN_NEGRO = 5;

unsigned long DURACION_ESTUDIO_MS_DEFECTO = 70000UL;
unsigned long DURACION_PAUSA_MS_DEFECTO   = 70000UL;


byte animInicioData[6][8] = {
    {B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000},
    {B00000000,B01100000,B01000000,B01100000,B01000000,B01000000,B00000000,B00000000},
    {B00000000,B01100000,B01000000,B01100000,B01000000,B01000000,B00000000,B0000000G},
    {B00000000,B01100010,B01000010,B01100010,B01000010,B01000010,B00000000,B00000000},
    {B00000000,B01100010,B01000010,B01100010,B01000010,B01000010,B00000000,B00000000},
    {B00000000,B01100010,B01000010,B01100010,B01000010,B01000010,B00000000,B00000000}
};
byte animEngranajeData[4][8] = {
    {B00111100,B01100110,B11000011,B10011001,B10011001,B11000011,B01100110,B00111100},
    {B00011000,B01011010,B01100110,B10011001,B01100110,B01011010,B00011000,B00000000},
    {B00111100,B01100110,B11000011,B10011001,B10011001,B11000011,B01100110,B00111100},
    {B00011000,B01011010,B01100110,B10011001,B01100110,B01011010,B00011000,B00000000}
};
byte animEstudioData[16][8] = {
    {B00000000,B00000000,B01000010,B00000000,B01000010,B01111110,B00001100,B00000000},
    {B00000000,B00000000,B01000010,B00000000,B01000010,B01111110,B00000000,B00000000},
    {B00000000,B00000000,B01000010,B00000000,B01000010,B01111110,B00000000,B00000000},
    {B00000000,B00000000,B01000010,B00000000,B00000000,B01111110,B00000000,B00000000},
    {B00000000,B00000000,B01000100,B00000000,B00000010,B00111110,B00000000,B00000000},
    {B00000000,B00000000,B01000100,B00000000,B00000000,B00011100,B00000000,B00000000},
    {B00000000,B00000000,B01000100,B00000000,B00000000,B00011100,B00000000,B00000000},
    {B00000000,B00000000,B01000100,B00000000,B00000000,B00011100,B00000000,B00000000},
    {B00000000,B00000000,B01000100,B00000000,B00000000,B00011100,B00000100,B00000000},
    {B00000000,B00000000,B01000100,B00000000,B00000000,B00011100,B00000000,B00000000},
    {B00000000,B00000000,B01000100,B00000000,B00000000,B00011100,B00000000,B00000000},
    {B00000000,B00000000,B01000100,B00000000,B00000000,B00111110,B00000000,B00000000},
    {B00000000,B00000000,B01000010,B00000000,B00000000,B01111110,B00000000,B00000000},
    {B00000000,B00000000,B01000010,B00000000,B01000010,B01111110,B00000000,B00000000},
    {B00000000,B00000000,B01000010,B00000000,B01000010,B01111110,B00000000,B00000000},
    {B00000000,B00000000,B01000010,B00000000,B01000010,B01111110,B00000000,B00000000}
};
byte animPausaData[8][8] = {
    {B01111110,B01000010,B01011010,B01011010,B01011010,B01000010,B01111110,B00000000},
    {B01111110,B01000010,B01010010,B01011010,B01011010,B01000010,B01111110,B00000000},
    {B01111110,B01000010,B01000010,B01011010,B01110010,B01000010,B01111110,B00000000},
    {B01111110,B01000010,B01000010,B01010010,B01101010,B01000010,B01111110,B00000000},
    {B01111110,B01000010,B01000010,B01000010,B01111010,B01000010,B01111110,B00000000},
    {B01111110,B01000010,B01000010,B01000010,B01111110,B01000010,B01111110,B00000000},
    {B01111110,B00100100,B00011000,B00011000,B00011000,B00100100,B01111110,B00000000},
    {B01111110,B01000010,B01111110,B01111110,B01000010,B01000010,B01111110,B00000000}
};

Animation ANIM_INICIO    = { (const byte*)animInicioData, 6 };
Animation ANIM_ENGRANAJE = { (const byte*)animEngranajeData, 4 };
Animation ANIM_ESTUDIO   = { (const byte*)animEstudioData, 16 };
Animation ANIM_PAUSA     = { (const byte*)animPausaData, 8 };

AppController app(miTimer, miAnimador, lcd,
                  PIN_VERDE, PIN_ROJO, PIN_NEGRO,
                  DURACION_ESTUDIO_MS_DEFECTO, DURACION_PAUSA_MS_DEFECTO,
                  ANIM_INICIO, ANIM_ENGRANAJE, ANIM_ESTUDIO, ANIM_PAUSA);


void setup() {
    Serial.begin(9600);
    Serial.println("--- Bienvenido a Studino! ---");

    lc.shutdown(0,false); 
    lc.setIntensity(0,8);
    lc.clearDisplay(0); 

    app.iniciar();
}

void loop() {
    app.actualizar();
}